(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{21:function(e,t,n){e.exports=n(33)},33:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(19),l=n.n(o),c=n(4),s=function(e){return fetch("/user/login",{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(function(e){return 401!==e.status?e.json().then(function(e){return e}):{isAuthenticated:!1,user:{username:"",role:""}}})},u=function(e){return fetch("/user/register",{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){return e})},m=function(){return fetch("/user/logout").then(function(e){return e.json()}).then(function(e){return e})},i=function(){return fetch("/user/authenticated").then(function(e){return 401!==e.status?e.json().then(function(e){return e}):{isAuthenticated:!1,user:{username:"",role:""}}})},b=Object(a.createContext)(),d=function(e){var t=e.children,n=Object(a.useState)(null),o=Object(c.a)(n,2),l=o[0],s=o[1],u=Object(a.useState)(!1),m=Object(c.a)(u,2),d=m[0],f=m[1],E=Object(a.useState)(null),h=Object(c.a)(E,2),p=h[0],g=h[1];return Object(a.useEffect)(function(){i().then(function(e){s(e.user),f(e.isAuthenticated),g(!0)})},[]),r.a.createElement("div",null,p?r.a.createElement(b.Provider,{value:{user:l,setUser:s,isAuthenticated:d,setIsAuthenticated:f}},t):r.a.createElement("h1",null,"Loading.."))},f=n(7),E=function(e){var t=Object(a.useContext)(b),n=t.isAuthenticated,o=t.user,l=t.setIsAuthenticated,c=t.setUser,s=function(){m().then(function(e){e.success&&(c(e.user),l(!1))})};return r.a.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light"},r.a.createElement(f.b,{to:"/"},r.a.createElement("div",{className:"navbar-brand"},"Trace")),r.a.createElement("div",{className:"collapse navbar-collapse",id:"navbarText"},r.a.createElement("ul",{className:"navbar-nav mr-auto"},n?r.a.createElement(r.a.Fragment,null,r.a.createElement(f.b,{to:"/"},r.a.createElement("li",{className:"nav-item nav-link"},"Home")),r.a.createElement(f.b,{to:"/todos"},r.a.createElement("li",{className:"nav-item nav-link"},"Todos")),"admin"===o.role?r.a.createElement(f.b,{to:"/admin"},r.a.createElement("li",{className:"nav-item nav-link"},"Admin")):null,r.a.createElement("button",{type:"button",className:"btn btn-link nav-item nav-link",onClick:s},"Logout")):r.a.createElement(r.a.Fragment,null,r.a.createElement(f.b,{to:"/"},r.a.createElement("li",{className:"nav-item nav-link"},"Home")),r.a.createElement(f.b,{to:"/login"},r.a.createElement("li",{className:"nav-item nav-link"},"Login")),r.a.createElement(f.b,{to:"/register"},r.a.createElement("li",{className:"nav-item nav-link"},"Register"))))))},h=n(10),p=n(12),g=function(e){var t="alert";return e.message.msgError?t+="alert-danger":t+="alert-primary",t+"text-center"},v=function(e){return r.a.createElement("div",{className:g(e),role:"alert"},e.message.msgBody)},j=function(e){var t=Object(a.useState)({username:"",password:""}),n=Object(c.a)(t,2),o=n[0],l=n[1],u=Object(a.useState)(null),m=Object(c.a)(u,2),i=m[0],d=m[1],f=Object(a.useContext)(b),E=function(e){e.preventDefault(),l(Object(p.a)({},o,Object(h.a)({},e.target.name,e.target.value))),console.log(o)};return r.a.createElement("div",null,r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),s(o).then(function(t){console.log(t);var n=t.isAuthenticated,a=t.user,r=t.message;n?(f.setUser(a),f.setIsAuthenticated(n),e.history.push("/todos")):d(r)})}},r.a.createElement("h3",null,"Please Sign In"),r.a.createElement("label",{htmlFor:"username",className:"sr-only"},"Username: "),r.a.createElement("input",{type:"text",name:"username",onChange:E,className:"form-control",placeholder:"Enter Username"}),r.a.createElement("label",{htmlFor:"username",className:"sr-only"},"Password: "),r.a.createElement("input",{type:"text",name:"password",onChange:E,className:"form-control",placeholder:"Enter Password"}),r.a.createElement("button",{className:"btn btn-lg btn-primary btn-block",type:"submit"},"Log in")),i?r.a.createElement(v,{message:i}):null)},O=function(){return r.a.createElement("h1",null,"Home Page")},y=function(e){return r.a.createElement("li",null,e.todo.name)},N=function(){return fetch("/user/todos").then(function(e){return 401!=e.status?e.json().then(function(e){return e}):{message:{msgBody:"UnAuthorized"},msgError:!0}})},S=function(e){return fetch("/user/todo",{method:"post",body:JSON.stringify(e),headers:{"Content=Type":"application/json"}}).then(function(e){return 401!=e.status?e.json().then(function(e){return e}):{message:{msgBody:"UnAuthorized"},msgError:!0}})},x=function(e){var t=Object(a.useState)({name:""}),n=Object(c.a)(t,2),o=n[0],l=n[1],s=Object(a.useState)([]),u=Object(c.a)(s,2),m=u[0],i=u[1],d=Object(a.useState)(null),f=Object(c.a)(d,2),E=f[0],h=f[1],p=Object(a.useContext)(b);Object(a.useEffect)(function(){N().then(function(e){i(e.todos)})},[]);var g=function(){l({name:""})};return r.a.createElement("div",null,r.a.createElement("ul",{className:"list-group"},m.map(function(e){return r.a.createElement(y,{key:e._id,todo:e})})),r.a.createElement("br",null),r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),S(o).then(function(e){var t=e.message;g(),t.msgError?"UnAuthorized"===t.msgBody?(h(t),p.setUser({username:"",role:""}),p.setIsAuthenticated(!1)):h(t):N().then(function(e){i(e.todos),h(t)})})}},r.a.createElement("label",{htmlFor:"todo"},"Enter Todo"),r.a.createElement("input",{type:"text",name:"todo",value:o.name,onChange:function(e){l({name:e.target.value})},className:"form-control",placeholder:"Please Enter Todo"}),r.a.createElement("button",{className:"btn btn-lg btn-primary btn-block",type:"submit"},"Submit")),E?r.a.createElement(v,{message:E}):null)},A=function(e){var t=Object(a.useState)({username:"",password:"",role:""}),n=Object(c.a)(t,2),o=n[0],l=n[1],s=Object(a.useState)(null),m=Object(c.a)(s,2),i=m[0],b=m[1],d=Object(a.useRef)(null);Object(a.useEffect)(function(){return function(){clearTimeout(d)}},[]);var f=function(e){l(Object(p.a)({},o,Object(h.a)({},e.target.name,e.target.value)))};return r.a.createElement("div",null,r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),u(o).then(function(t){var n=t.message;b(n),l({uesrname:"",password:"",role:""}),n.msgError||(d=setTimeout(function(){e.history.push("/login")},2e3))})}},r.a.createElement("h3",null,"Please Register"),r.a.createElement("label",{htmlFor:"username",className:"sr-only"},"Username: "),r.a.createElement("input",{type:"text",name:"username",value:o.username,onChange:f,className:"form-control",placeholder:"Enter Username"}),r.a.createElement("label",{htmlFor:"username",className:"sr-only"},"Password: "),r.a.createElement("input",{type:"text",name:"password",value:o.password,onChange:f,className:"form-control",placeholder:"Enter Password"}),r.a.createElement("label",{htmlFor:"role",className:"sr-only"},"Role: "),r.a.createElement("input",{type:"text",name:"role",value:o.role,onChange:f,className:"form-control",placeholder:"Enter role (admin/user)"}),r.a.createElement("button",{className:"btn btn-lg btn-primary btn-block",type:"submit"},"Register")),i?r.a.createElement(v,{message:i}):null)},w=function(){return r.a.createElement("h1",null,"Admin Page")},C=n(13),k=n(2),U=function(e){var t=e.component,n=Object(C.a)(e,["component"]),o=Object(a.useContext)(b).isAuthenticated;return r.a.createElement(k.b,Object.assign({},n,{render:function(e){return o?r.a.createElement(t,e):r.a.createElement(k.a,{to:{pathname:"/",state:{from:e.location}}})}}))},P=function(e){var t=e.component,n=e.roles,o=Object(C.a)(e,["component","roles"]),l=Object(a.useContext)(b),c=l.isAuthenticated,s=l.user;return r.a.createElement(k.b,Object.assign({},o,{render:function(e){return c?n.includes(s.role)?r.a.createElement(t,e):r.a.createElement(k.a,{to:{pathname:"/",state:{from:e.location}}}):r.a.createElement(k.a,{to:{pathname:"/login",state:{from:e.location}}})}}))};var T=function(){return r.a.createElement(f.a,null,r.a.createElement(E,null),r.a.createElement(k.b,{exact:!0,path:"/",component:O}),r.a.createElement(U,{path:"/login",component:j}),r.a.createElement(U,{path:"/register",component:A}),r.a.createElement(P,{path:"/todos",roles:["user","admin"],component:x}),r.a.createElement(P,{path:"/admin",roles:["admin"],component:w}))};l.a.render(r.a.createElement(d,null,r.a.createElement(T,null)),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.c26a37af.chunk.js.map